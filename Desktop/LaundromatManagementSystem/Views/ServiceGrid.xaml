<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:LaundromatManagementSystem.ViewModels"
             x:Class="LaundromatManagementSystem.Views.ServiceGrid"
             x:DataType="vm:ServiceGridViewModel">

    <Grid RowDefinitions="Auto, *">

        <!-- Category Tabs -->
        <Grid Grid.Row="0"
              ColumnDefinitions="*, *, *, *"
              ColumnSpacing="12"
              Margin="0,0,0,24">

            <!-- WASH Button -->
            <Border Grid.Column="0"
                    BackgroundColor="{Binding WashButtonBackground}"
                    Stroke="{Binding WashButtonBorder}"
                    StrokeThickness="1"
                    StrokeShape="RoundRectangle 8,8,8,8"
                    HeightRequest="64">

                <Label Text="{Binding WashText}"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{Binding WashButtonTextColor}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding SelectWashCommand}"/>
                </Border.GestureRecognizers>
            </Border>

            <!-- DRY Button -->
            <Border Grid.Column="1"
                    BackgroundColor="{Binding DryButtonBackground}"
                    Stroke="{Binding DryButtonBorder}"
                    StrokeThickness="1"
                    StrokeShape="RoundRectangle 8,8,8,8"
                    HeightRequest="64">
                <Label Text="{Binding DryText}"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{Binding DryButtonTextColor}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding SelectDryCommand}"/>
                </Border.GestureRecognizers>
            </Border>

            <!-- ADD-ON Button -->
            <Border Grid.Column="2"
                    BackgroundColor="{Binding AddonButtonBackground}"
                    Stroke="{Binding AddonButtonBorder}"
                    StrokeThickness="1"
                    StrokeShape="RoundRectangle 8,8,8,8"
                    HeightRequest="64">
                <Label Text="{Binding AddonText}"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{Binding AddonButtonTextColor}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding SelectAddonCommand}"/>
                </Border.GestureRecognizers>
            </Border>

            <!-- PACKAGE Button -->
            <Border Grid.Column="3"
                    BackgroundColor="{Binding PackageButtonBackground}"
                    Stroke="{Binding PackageButtonBorder}"
                    StrokeThickness="1"
                    StrokeShape="RoundRectangle 8,8,8,8"
                    HeightRequest="64">
                <Label Text="{Binding PackageText}"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{Binding PackageButtonTextColor}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding SelectPackageCommand}"/>
                </Border.GestureRecognizers>
            </Border>

        </Grid>

        <!-- Services Grid -->
        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding Services}"
                        SelectionMode="None">

            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical"
                                 Span="3"
                                 HorizontalItemSpacing="24"
                                 VerticalItemSpacing="24"/>
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="vm:ServiceViewModel">

                    <Frame
                        BackgroundColor="{Binding ServiceBackgroundColor}"
                        BorderColor="{Binding ServiceBorderColor}"
                        CornerRadius="16"
                        Padding="20"
                        Margin="10"
                        HeightRequest="330"
                        HasShadow="True">

                        <!-- MAUI Shadow -->
                        <Frame.Shadow>
                            <Shadow
                                Brush="{Binding ShadowColor}"
                                Offset="4,4"
                                Radius="10"/>
                        </Frame.Shadow>

                        <!-- Hover / Visual States (Scale only) -->
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">

                                <VisualState x:Name="Normal">
                                    <VisualState.Setters>
                                        <Setter Property="Scale"
                                                Value="1"/>
                                    </VisualState.Setters>
                                </VisualState>

                                <!-- Works on Windows & Mac -->
                                <VisualState x:Name="PointerOver">
                                    <VisualState.Setters>
                                        <Setter Property="Scale"
                                                Value="1.05"/>
                                    </VisualState.Setters>
                                </VisualState>

                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>

                        <!-- Content -->
                        <VerticalStackLayout Spacing="16">

                            <!-- Icon -->
                            <Border
                                BackgroundColor="{Binding IconBackgroundColor}"
                                StrokeThickness="0"
                                StrokeShape="RoundRectangle 44"
                                WidthRequest="88"
                                HeightRequest="88"
                                HorizontalOptions="Center">

                                <Label
                                    Text="{Binding Icon}"
                                    FontSize="48"
                                    TextColor="{Binding IconColor}"
                                    HorizontalOptions="Center"
                                    VerticalOptions="Center"/>
                            </Border>

                            <!-- Name -->
                            <Label
                                Text="{Binding Name}"
                                FontSize="16"
                                FontAttributes="Bold"
                                TextColor="{Binding TextColor}"
                                HorizontalTextAlignment="Center"/>

                            <!-- Description -->
                            <Label
                                Text="{Binding Description}"
                                FontSize="12"
                                TextColor="{Binding DescriptionColor}"
                                HorizontalTextAlignment="Center"
                                IsVisible="{Binding HasDescription}"/>

                            <!-- Price -->
                            <Border
                                BackgroundColor="{Binding PriceBackgroundColor}"
                                StrokeThickness="0"
                                StrokeShape="RoundRectangle 8"
                                Padding="16,12">

                                <VerticalStackLayout Spacing="4">

                                    <Label
                                        FontSize="24"
                                        FontAttributes="Bold"
                                        HorizontalOptions="Center"
                                        TextColor="White"
                                        Text="{Binding Price, StringFormat='{0:N0}'}">

                                        <Label.Triggers>
                                            <DataTrigger
                                                TargetType="Label"
                                                Binding="{Binding Price}"
                                                Value="0">
                                                <Setter Property="Text"
                                                        Value="Free"/>
                                                <Setter Property="TextColor"
                                                        Value="#10B981"/>
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>

                                    <Label
                                        FontSize="12"
                                        HorizontalOptions="Center"
                                        Text="RWF"
                                        TextColor="White">

                                        <Label.Triggers>
                                            <DataTrigger
                                                TargetType="Label"
                                                Binding="{Binding Price}"
                                                Value="0">
                                                <Setter Property="Text"
                                                        Value="Complimentary"/>
                                                <Setter Property="TextColor"
                                                        Value="#10B981"/>
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>

                                </VerticalStackLayout>
                            </Border>

                            <!-- CTA -->
                            <Label
                                Text="{Binding TapToAddText}"
                                FontSize="12"
                                TextColor="{Binding TapToAddColor}"
                                HorizontalOptions="Center"/>

                        </VerticalStackLayout>

                        <!-- Tap -->
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding AddToCartCommand}"/>
                        </Frame.GestureRecognizers>

                    </Frame>

                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

    </Grid>
</ContentView>